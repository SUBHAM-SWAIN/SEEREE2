<script src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>

<input type="text" name="ProdId" id="ProdId" hidden><br />
<input type="text" name="ProdName" id="ProdName"
    placeholder="Enter Product Name"><br />
<input type="text" name="ProdDescription" id="ProdDescription"
    placeholder="Enter Product Description"><br />
<input type="text" name="ProdPrice" id="ProdPrice"
    placeholder="Enter Product Price"><br />
<input type="submit" name="btn" id="btn" value="Add Product">

<table border="1" width="100%" cellspacing="0" cellpadding="0"
    style="text-align: center;">
    <thead>
        <tr>
            <th>Sl No</th>
            <th>Product Name</th>
            <th>Product Description</th>
            <th>Product Price</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="tb"></tbody>
</table>

<script>
    $(document).ready(function(){
        $.ajax({
            url:'/api/getProducts',
            type:'get',
            dataType:'json',
            success:function(res){
                tb='';
                if(res.length>0){
                    $.each(res,function(index,product){
                        tb += `<tr>
                                <td>${index + 1}</td>
                                <td>${product.ProdName}</td>
                                <td>${product.ProdDescription}</td>
                                <td>${product.ProdPrice}</td>
                                <td>
                                    <button class="btn btn-danger" onclick="deleteProduct('${product._id}')">Delete</button>
                                    <button class="btn btn-primary" onclick="editProduct('${product._id}')">Edit</button>
                                </td>
                            </tr>`;
                    })
                }else{
                    tb +=`<tr><td colspan="4">No Products Found</td></tr>`;
                }
                $('#tb').html(tb);
            }
        })
        $('#btn').click(function(event){
            event.preventDefault();
            btn=$('#btn').val();
            if(btn == 'Add Product'){
                $.ajax({
                    url:'/api/addProduct',
                    type:'post',
                    dataType:'json',
                    data:{
                        ProdName: $('#ProdName').val(),
                        ProdDescription: $('#ProdDescription').val(),
                        ProdPrice: $('#ProdPrice').val()
                    },
                    success:function(res){
                        alert(res.message);
                        location.reload();
                    }
                })
            }else{
                $.ajax({
                    url:'/api/updateProduct',
                    type:'post',
                    dataType:'json',
                    data:{
                        ProdId: $('#ProdId').val(),
                        ProdName: $('#ProdName').val(),
                        ProdDescription: $('#ProdDescription').val(),
                        ProdPrice: $('#ProdPrice').val()
                    },
                    success:function(res){
                        alert(res.message);
                        location.reload();
                    }
                })
            }
        })
    })
    function deleteProduct(id){
        if(confirm("Are you sure you want to delete this product?")){
            $.ajax({
                url:`/api/deleteProduct/${id}`,
                type:'get',
                dataType:'json',
                success:function(res){
                    alert(res.message);
                    location.reload();
                }
            })
        }
    }
    function editProduct(id){
        $.ajax({
            url:`/api/fetchProduct/${id}`,
            type:'get',
            dataType:'json',
            success:function(product){
                $('#ProdId').val(product._id);
                $('#ProdName').val(product.ProdName);
                $('#ProdDescription').val(product.ProdDescription);
                $('#ProdPrice').val(product.ProdPrice);
                $('#btn').val('Update Product');
            }
        })
    }
</script>